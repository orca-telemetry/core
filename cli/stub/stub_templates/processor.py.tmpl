import time

from orca_python import (
    Processor,
    WindowType,
    StructResult,
    MetadataField,
    ExecutionParams,
)

proc = Processor(
    name="{{ .Name }}",
    _stub=True
)

# --- Metadata Fields ---
{{ range .Metadata }}
{{ .VarName }} = MetadataField(
    name="{{ .KeyName }}", 
    description="{{ .Description }}",
    _stub=True
)
{{ end }}

# --- Window Types ---
{{ range .Windows }}
{{ .VarName }} = WindowType(
    name="{{ .Name }}",
    version="{{ .Version }}",
    description="{{ .Description }}",
    metadataFields=[{{ range $i, $m := .MetadataVarNames }}{{ if $i }}, {{ end }}{{ $m }}{{ end }}],
    _stub=True
)
{{ end }}

# --- Algorithms ---
{{ range .Algorithms -}}
@proc.algorithm("{{ .Name }}", "{{ .Version }}", {{ .WindowVarName }}, _stub=True)
def {{ .Name | ToSnakeCase }}(params: ExecutionParams) -> {{ .ReturnType }}:
    """
    Autogenerated stub for {{ .Name }}
    """
    {{- range .MetadataKeys }}
    {{ .VarName }} = params.window.metadata.get("{{ .KeyName }}", None)
    {{- end }}
    
    {{if eq .ReturnType "StructResult" }}
    return StructResult({"result": 0})
    {{else if eq .ReturnType "ValueResult" }}
    return ValueResult(0)
    {{else if eq .ReturnType "ArrayResult" }}
    return ArrayResult([])
    {{else if eq .ReturnType "NoneResult" }}
    return NoneResult()
    {{else }}
    return None # Fallback
    {{end }}
{{ end }}
